{"ast":null,"code":"import SearchResults from \"../../components/SearchResults/SearchResults\";\nlet accessToken;\nconst clientID = '6fcae6e681ed465d9b593ad989a8b758';\nconst redirectURI = 'http://localhost:3000';\nlet Spotify = {\n  getAccessToken() {\n    if (accessToken) return accessToken;else {\n      let urlInBrowser = window.location.href;\n      let accessTokenMatch = urlInBrowser.match(/access_token=([^&]*)/);\n      let expiresInMatch = urlInBrowser.match(/expires_in=([^&]*)/);\n      let expiresIn;\n\n      if (accessTokenMatch) {\n        let accessToken = accessTokenMatch[1];\n        expiresIn = expiresInMatch[1];\n        window.setTimeout(() => accessToken = '', expiresIn * 1000);\n        window.history.pushState('Access Token', null, '/');\n        alert('Auth token successfully captured!');\n        return accessToken;\n      } else {\n        window.location = `https://accounts.spotify.com/authorize?client_id=${clientID}&response_type=token&scope=playlist-modify-public&redirect_uri=${redirectURI}`;\n        alert('Redirecting to Spotify auth screen');\n      }\n    }\n  },\n\n  search(searchTerm) {\n    let accessTokenVar = this.getAccessToken();\n    return fetch(`https://cors-anywhere.herokuapp.com/https://api.spotify.com/v1/search?type=track&q=${searchTerm}`, {\n      headers: {\n        'Authorization': `Bearer ${accessTokenVar}`\n      }\n    }).then(response => {\n      console.log(response);\n\n      if (response.ok) {\n        return response.json();\n      } else {\n        throw new Error('Something has gone wrong');\n      }\n    }).then(responseJson => {\n      responseJson.map(track => {\n        return {\n          id: track.id,\n          name: track.name,\n          artist: track.artists[0].name,\n          album: track.album.name,\n          uri: track.uri\n        };\n      });\n    });\n  },\n\n  savePlaylist(playlistName, playlistURIs) {\n    if (playlistURIs && playlistName) {\n      let accessTokenVar = this.getAccessToken; // se dà problemi, cambiare con accessToken diretto\n\n      let headers = {\n        'Authorization': `Bearer: ${accessTokenVar}`\n      };\n      let userID;\n      fetch('https://cors-anywhere.herokuapp.com/https://api.spotify.com/v1/me', {\n        headers: headers\n      }).then(response => {\n        if (response.ok) {\n          return response.json();\n        } else {\n          alert('error!');\n        }\n      }).then(responseJson => {\n        userID = responseJson.id;\n        fetch(`https://api.spotify.com/v1/users/${userID}/playlists`, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer: ${accessTokenVar}`,\n            'Content-Type': 'application/json'\n          },\n          body: {\n            'name': playlistName\n          }\n        });\n      }).then(playlistResponse => {\n        if (playlistResponse.ok) {\n          return playlistResponse.json();\n        } else {\n          alert('error after playlist creation');\n        }\n      }).then(playlistResponseJson => {\n        fetch(`https://cors-anywhere.herokuapp.com/https://api.spotify.com/v1/users/${userID}/playlists/${playlistResponseJson.id}/tracks`, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer: ${accessTokenVar}`,\n            'Content-Type': 'application/json'\n          },\n          body: {\n            'uris': playlistURIs\n          }\n        });\n      });\n    } else return undefined;\n  }\n\n};\nexport default Spotify;","map":{"version":3,"sources":["/Users/roberttiu/Progetti/jammming/src/util/Spotify/Spotify.js"],"names":["SearchResults","accessToken","clientID","redirectURI","Spotify","getAccessToken","urlInBrowser","window","location","href","accessTokenMatch","match","expiresInMatch","expiresIn","setTimeout","history","pushState","alert","search","searchTerm","accessTokenVar","fetch","headers","then","response","console","log","ok","json","Error","responseJson","map","track","id","name","artist","artists","album","uri","savePlaylist","playlistName","playlistURIs","userID","method","body","playlistResponse","playlistResponseJson","undefined"],"mappings":"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","sourcesContent":["import SearchResults from \"../../components/SearchResults/SearchResults\";\n\nlet accessToken;\nconst clientID = '6fcae6e681ed465d9b593ad989a8b758';\nconst redirectURI = 'http://localhost:3000'\nlet Spotify = {\n    getAccessToken() {\n        if(accessToken) return accessToken;\n        else {\n            let urlInBrowser = window.location.href;\n            let accessTokenMatch = urlInBrowser.match(/access_token=([^&]*)/);\n            let expiresInMatch = urlInBrowser.match(/expires_in=([^&]*)/);\n            let expiresIn;\n            if(accessTokenMatch) {\n                let accessToken = accessTokenMatch[1];\n                expiresIn = expiresInMatch[1];\n                window.setTimeout( () => accessToken = '', expiresIn * 1000);\n                window.history.pushState('Access Token', null, '/');\n                alert('Auth token successfully captured!')\n                return accessToken;\n            }\n            else {\n                window.location = `https://accounts.spotify.com/authorize?client_id=${clientID}&response_type=token&scope=playlist-modify-public&redirect_uri=${redirectURI}`;\n                alert('Redirecting to Spotify auth screen');\n            }\n\n            \n        }\n    },\n\n    search(searchTerm) {\n        let accessTokenVar = this.getAccessToken();\n        return fetch(`https://cors-anywhere.herokuapp.com/https://api.spotify.com/v1/search?type=track&q=${searchTerm}`, \n        {\n            headers: { 'Authorization': `Bearer ${accessTokenVar}`}\n        }).then(response => {\n            console.log(response);\n            if(response.ok) {\n\n                return response.json();\n            }\n            else {\n                throw(new Error('Something has gone wrong'));\n            }\n        }).then(responseJson => {\n            responseJson.map(track => {\n                return {\n                    id: track.id,\n                    name: track.name,\n                    artist: track.artists[0].name,\n                    album: track.album.name,\n                    uri: track.uri\n                }\n\n            })\n        })\n    },\n\n    savePlaylist(playlistName, playlistURIs) {\n        if(playlistURIs && playlistName) {\n            let accessTokenVar = this.getAccessToken; // se dà problemi, cambiare con accessToken diretto\n            let headers = { 'Authorization': `Bearer: ${accessTokenVar}` };\n            let userID;\n            fetch('https://cors-anywhere.herokuapp.com/https://api.spotify.com/v1/me', { headers: headers } )\n                .then(response => {\n                    if(response.ok) {\n                        return response.json();\n                    }\n                    else {\n                        alert('error!');\n                    }\n                })\n                .then(responseJson => {\n                    userID = responseJson.id;\n                    fetch(`https://api.spotify.com/v1/users/${userID}/playlists`,\n                    {\n                        method: 'POST',\n                        headers: {\n                            'Authorization': `Bearer: ${accessTokenVar}`,\n                            'Content-Type': 'application/json',\n                        },\n                        body: {\n                            'name': playlistName,\n                        }\n                    })\n                })\n                .then(playlistResponse => {\n                    if(playlistResponse.ok) {\n                        return playlistResponse.json();\n                    }\n                    else {\n                        alert('error after playlist creation');\n                    }\n                })\n                .then(playlistResponseJson => {\n                    fetch(`https://cors-anywhere.herokuapp.com/https://api.spotify.com/v1/users/${userID}/playlists/${playlistResponseJson.id}/tracks`, \n                    {\n                        method: 'POST',\n                        headers: {\n                             'Authorization': `Bearer: ${accessTokenVar}` ,\n                             'Content-Type': 'application/json',\n                            },\n                        body: {\n                            'uris': playlistURIs,\n                        }\n                    })\n                })\n\n        } else return undefined;\n    }\n}\n\nexport default Spotify;"]},"metadata":{},"sourceType":"module"}