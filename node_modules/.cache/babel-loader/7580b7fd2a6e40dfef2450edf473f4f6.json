{"ast":null,"code":"let accessToken;\nconst clientID = '6fcae6e681ed465d9b593ad989a8b758';\nconst redirectURI = 'http://localhost:3000';\nlet Spotify = {\n  getAccessToken() {\n    if (accessToken) {\n      return accessToken;\n    } else {\n      let urlInBrowser = window.location.href;\n      let accessTokenMatch = urlInBrowser.match(/access_token=([^&]*)/);\n      let expiresInMatch = urlInBrowser.match(/expires_in=([^&]*)/);\n      let expiresIn;\n\n      if (accessTokenMatch) {\n        accessToken = accessTokenMatch[1];\n        expiresIn = expiresInMatch[1];\n        window.setTimeout(() => accessToken = '', expiresIn * 1000);\n        window.history.pushState('Access Token', null, '/');\n        console.log('Auth token successfully captured!');\n        return accessToken;\n      } else {\n        window.location = `https://accounts.spotify.com/authorize?client_id=${clientID}&response_type=token&scope=playlist-modify-public&redirect_uri=${redirectURI}`;\n        console.log('Redirecting to Spotify auth screen');\n      }\n    }\n  },\n\n  search(searchTerm) {\n    return fetch(`https://api.spotify.com/v1/search?type=track&q=${searchTerm}`, {\n      headers: {\n        'Authorization': `Bearer ${this.getAccessToken()}`\n      }\n    }).then(response => {\n      if (response.ok) {\n        console.log('Successfully got a response for the track fetching');\n        return response.json();\n      } else {\n        throw new Error('Something has gone wrong while fetching the tracks');\n      }\n    }).then(responseJson => {\n      return responseJson.tracks.items.map(track => {\n        let fetchedTrackObj = {\n          id: track.id,\n          name: track.name,\n          artist: track.artists[0].name,\n          album: track.album.name,\n          uri: track.uri\n        };\n        return trackObj;\n      });\n    });\n  },\n\n  savePlaylist(playlistName, playlistURIs) {\n    if (playlistURIs && playlistName) {\n      let accessTokenVar;\n\n      if (accessToken) {\n        accessTokenVar = accessToken;\n      } else {\n        this.getAccessToken();\n        accessTokenVar = accessToken;\n      }\n\n      alert(accessTokenVar);\n      let userID;\n      return fetch('https://api.spotify.com/v1/me', {\n        headers: {\n          'Authorization': `Bearer ${this.getAccessToken()}`\n        }\n      }).then(response => {\n        console.log('check this out');\n        console.log(response);\n        alert('the response from the playlist creation was ' + response.ok);\n        return response.json();\n      }).then(responseJson => {\n        userID = responseJson.id;\n        console.log(`I have assigned this userid ${userID}`);\n      }).then(() => {\n        return fetch(`https://api.spotify.com/v1/users/${userID}/playlists`, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${this.getAccessToken()}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            name: playlistName\n          })\n        });\n      }).then(playlistResponse => {\n        console.log('the playlist response obj was ' + playlistResponse.ok);\n        return playlistResponse.json();\n        /*                     console.log('Mi spieghi che cazzo restituisci');\n        console.log(playlistResponse); */\n\n        /*                     console.log('Here');\n                            console.log(playlistResponse);\n                            alert('playlistResponse is ' + playlistResponse);\n        \n                            if(playlistResponse.ok) {\n                                return playlistResponse.json();\n                            }\n                            else {\n                                throw(Error('Error while fetching playlist creation response.'));\n                            } */\n      }).then(playlistResponseJson => {\n        console.log('Sono arrivato fino a qui');\n        console.log(playlistResponseJson.name);\n        console.log(playlistURIs);\n        fetch(`https://api.spotify.com/v1/playlists/${playlistResponseJson.id}/tracks`, {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${this.getAccessToken()}`,\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            uris: playlistURIs\n          })\n        });\n      });\n    } else alert('missing something');\n  }\n\n};\nexport default Spotify;","map":{"version":3,"sources":["/Users/roberttiu/Progetti/jammming/src/util/Spotify/Spotify.js"],"names":["accessToken","clientID","redirectURI","Spotify","getAccessToken","urlInBrowser","window","location","href","accessTokenMatch","match","expiresInMatch","expiresIn","setTimeout","history","pushState","console","log","search","searchTerm","fetch","headers","then","response","ok","json","Error","responseJson","tracks","items","map","track","fetchedTrackObj","id","name","artist","artists","album","uri","trackObj","savePlaylist","playlistName","playlistURIs","accessTokenVar","alert","userID","method","body","JSON","stringify","playlistResponse","playlistResponseJson","uris"],"mappings":"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","sourcesContent":["let accessToken;\nconst clientID = '6fcae6e681ed465d9b593ad989a8b758';\nconst redirectURI = 'http://localhost:3000'\n\nlet Spotify = {\n    getAccessToken() {\n        if (accessToken) {\n            return accessToken;\n        }\n        else {\n            let urlInBrowser = window.location.href;\n            let accessTokenMatch = urlInBrowser.match(/access_token=([^&]*)/);\n            let expiresInMatch = urlInBrowser.match(/expires_in=([^&]*)/);\n            let expiresIn;\n\n            if (accessTokenMatch) {\n                accessToken = accessTokenMatch[1];\n                expiresIn = expiresInMatch[1];\n\n                window.setTimeout(() => accessToken = '', expiresIn * 1000);\n                window.history.pushState('Access Token', null, '/');\n\n                console.log('Auth token successfully captured!')\n                return accessToken;\n            }\n\n            else {\n                window.location = `https://accounts.spotify.com/authorize?client_id=${clientID}&response_type=token&scope=playlist-modify-public&redirect_uri=${redirectURI}`;\n                console.log('Redirecting to Spotify auth screen');\n            }\n        }\n    },\n\n    search(searchTerm) {\n        return fetch(`https://api.spotify.com/v1/search?type=track&q=${searchTerm}`,\n            {\n                headers: { 'Authorization': `Bearer ${this.getAccessToken()}` }\n            })\n            .then(response => {\n\n                if (response.ok) {\n                    console.log('Successfully got a response for the track fetching')\n                    return response.json();\n                }\n                else {\n                    throw (new Error('Something has gone wrong while fetching the tracks'));\n                }\n            })\n            .then(responseJson => {\n        \n                return responseJson.tracks.items.map(track => {\n\n                    let fetchedTrackObj = {\n                        id: track.id,\n                        name: track.name,\n                        artist: track.artists[0].name,\n                        album: track.album.name,\n                        uri: track.uri\n                    }\n\n                    return trackObj;\n                })\n            })\n    },\n\n    savePlaylist(playlistName, playlistURIs) {\n        if (playlistURIs && playlistName) {\n            let accessTokenVar;\n            if (accessToken) {\n                accessTokenVar = accessToken\n            } else {\n                this.getAccessToken();\n                accessTokenVar = accessToken;\n            }\n            alert(accessTokenVar);\n            let userID;\n\n            return fetch('https://api.spotify.com/v1/me',\n                {\n                    headers: { 'Authorization': `Bearer ${this.getAccessToken()}` }\n                })\n                .then(response => {\n                    console.log('check this out');\n                    console.log(response);\n                    alert('the response from the playlist creation was ' + response.ok);\n                    return response.json();\n                })\n                .then(responseJson => {\n                    userID = responseJson.id;\n                    console.log(`I have assigned this userid ${userID}`);\n                })\n                .then( () => {\n                return fetch(`https://api.spotify.com/v1/users/${userID}/playlists`,\n                {\n                    method: 'POST',\n                    headers: {\n                        'Authorization': `Bearer ${this.getAccessToken()}`,\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                        name: playlistName\n\n                    }),\n                })})\n                .then(playlistResponse => {\n                    console.log('the playlist response obj was ' + playlistResponse.ok);\n                    return playlistResponse.json();\n                    /*                     console.log('Mi spieghi che cazzo restituisci');\n                    console.log(playlistResponse); */\n                    /*                     console.log('Here');\n                                        console.log(playlistResponse);\n                                        alert('playlistResponse is ' + playlistResponse);\n                    \n                                        if(playlistResponse.ok) {\n                                            return playlistResponse.json();\n                                        }\n                                        else {\n                                            throw(Error('Error while fetching playlist creation response.'));\n                                        } */\n\n                })\n                .then(playlistResponseJson => {\n                    console.log('Sono arrivato fino a qui');\n                    console.log(playlistResponseJson.name);\n                    console.log(playlistURIs);\n                    fetch(`https://api.spotify.com/v1/playlists/${playlistResponseJson.id}/tracks`,\n                        {\n                            method: 'POST',\n                            headers: {\n                                'Authorization': `Bearer ${this.getAccessToken()}`,\n                                'Content-Type': 'application/json',\n                            },\n                            body: JSON.stringify({\n                                uris: playlistURIs,\n                            })\n                        })\n                })\n\n        } else alert('missing something');\n    }\n}\n\nexport default Spotify;\n\n"]},"metadata":{},"sourceType":"module"}